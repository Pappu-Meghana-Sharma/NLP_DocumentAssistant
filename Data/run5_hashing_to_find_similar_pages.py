import wikipedia
import time
import hashlib
from multiprocessing import Pool, cpu_count

def fetch_and_parse_page(page_title):
   
    wikipedia.set_lang("te")
    try:
        page = wikipedia.page(page_title)
        return (page.title, page.content)
    except wikipedia.exceptions.PageError:
        print(f"  Error: Page '{page_title}' not found. Skipping.")
    except wikipedia.exceptions.DisambiguationError as e:
       
        print(f"  Error: Page '{page_title}' is a disambiguation page. Skipping.")
    except Exception as e:
        print(f"  An unexpected error occurred while processing '{page_title}': {e}")
    return (None, None)

def scrape_and_merge_telugu_text_from_search(search_query, output_filename, limit=50):

    wikipedia.set_lang("te")
    
    try:
        print(f"Searching for up to {limit} pages related to: '{search_query}'...")
        page_titles = wikipedia.search(search_query, results=limit)
        
        if not page_titles:
            print(f"No pages found for '{search_query}'.")
            return
            
        print(f"Found {len(page_titles)} pages. Starting parallel scraping...")

        with Pool(cpu_count()) as pool:
            results = pool.map(fetch_and_parse_page, page_titles)

        print("\nAll pages scraped. Starting content deduplication and merging...")

        scraped_content_hashes = set()
        unique_page_count = 0
        
        with open(output_filename, "a", encoding="utf-8") as output_file:
            output_file.write(f"\n\n--- Content for Search Term: {search_query} ---\n")
            
            for i, (title, content) in enumerate(results):
                percentage = (i + 1) / len(results) * 100
                print(f"  Processing result {i+1} of {len(results)}: {percentage:.1f}% done. Unique count: {unique_page_count}", end='\r')
                
                if title and content:
                    clean_content = content.lower().replace('\n', ' ').strip()
                    clean_content = ' '.join(clean_content.split())
                    
                    content_hash = hashlib.sha256(clean_content.encode('utf-8')).hexdigest()
                    
                    if content_hash not in scraped_content_hashes:
                        scraped_content_hashes.add(content_hash)
                        unique_page_count += 1
                        
                        output_file.write(f"\n\n--- Start of unique page: {title} ---\n")
                        output_file.write(content)
                        output_file.write(f"\n--- End of unique page: {title} ---\n")
            
            print(f"\n\n--- Search completed for '{search_query}' ---")
            print(f"  Total results processed: {len(results)}")
            print(f"  Unique pages written: {unique_page_count}")
        
        print(f"Data successfully merged. Total unique pages found so far: {len(scraped_content_hashes)}")

    except Exception as e:
        print(f"\nAn error occurred during the search: {e}")

if __name__ == "__main__":
    search_terms = [
     "సిపాయిల తిరుగుబాటు","అంటార్కిటికా","అంతరించిపోతున్న జాతులు","అంతర్జాతీయ సరిహద్దులు","అగ్ని","అట్లాంటిక్ మహాసముద్రం","అడవులు",
    "అథ్లెటిక్స్","అధికారాలు","అనారోగ్యం","అమెజాన్ వర్షారణ్యం","అమెరికా సంయుక్త రాష్ట్రాలు","అరబిక్ సముద్రం","అవార్డులు","అవినీతి","అశోకుడు","ఆంధ్రప్రదేశ్","ఆధునిక కవిత్వం",
    "ఆధ్యాత్మికత","ఆనందం","ఆనకట్టలు","ఆపరేటింగ్ సిస్టమ్","ఆపరేషన్","ఆఫ్రికా","ఆరావళి పర్వతాలు","ఆరోగ్య సంరక్షణ","ఆరోగ్యం","ఆర్థిక విధానం",
    "ఆర్థిక సంస్కరణలు","ఆర్ధిక శాస్త్రం","ఆల్బర్ట్ ఐన్‌స్టీన్","ఆశ్చర్యం","ఆసియా క్రీడలు","ఆసుపత్రి","ఆహార అలవాట్లు","ఆహార భద్రత","ఆహారం","ఇంటర్నెట్",
    "ఇందిరా గాంధీ","ఇడ్లీ","ఇన్సులిన్","ఇల్లు","ఇస్లాం మతం","ఈజిప్ట్","ఉత్తర ప్రదేశ్","ఉద్యోగిత","ఉపనిషత్తులు","ఉష్ణోగ్రత","ఊపిరితిత్తులు","ఎగుమతి దిగుమతి","ఎడారులు",
    "ఎన్.టి.ఆర్.","ఎఫ్డిఐ","ఎముకలు","ఎరువులు","ఎఱ్ఱన","ఏడుపు","ఐపీఎల్","ఒడిశా","ఒలింపిక్స్","ఔషధం","కండరాలు","కంప్యూటర్",
    "కంప్యూటర్లు",
    "కథక్",
    "కథా సాహిత్యం",
    "కన్యాశుల్కం",
    "కబడ్డీ",
    "కర్ణాటక",
    "కళలు",
    "కళింగ యుద్ధం",
    "కాకతీయ సామ్రాజ్యం",
    "కామన్వెల్త్ క్రీడలు",
    "కారు",
    "కార్తికేయ",
    "కార్బన్ డయాక్సైడ్",
    "కాలుష్య నియంత్రణ",
    "కాలుష్యం",
    "కాలేయం",
    "కావేరి నది",
    "కుటుంబం",
    "కులం",
    "కూచిపూడి",
    "కూరగాయలు",
    "కృత్రిమ మేధస్సు",
    "కృష్ణా నది",
    "కృష్ణుడు",
    "కేరళ",
    "కైరో",
    "కొడవలి",
    "కోపం",
    "కోవిడ్-19",
    "క్యాన్సర్",
    "క్యూబా",
    "క్రికెట్",
    "క్రిప్టోకరెన్సీ",
    "క్రీడాకారులు",
    "క్రైస్తవ మతం",
    "క్లౌడ్ కంప్యూటింగ్",
    "క్వాంటం ఫిజిక్స్",
    "క్విట్ ఇండియా ఉద్యమం",
    "క్షీరదాలు",
    "ఖగోళ శాస్త్రం",
    "ఖురాన్",
    "గంగా నది",
    "గణితం",
    "గాలి",
    "గాలి కాలుష్యం",
    "గుండె",
    "గుప్తుల కాలం",
    "గురజాడ అప్పారావు",
    "గురు గ్రంథ్ సాహిబ్",
    "గెలీలియో",
    "గొడ్డలి",
    "గోదావరి నది",
    "గోల్కొండ",
    "గోల్ఫ్",
    "గ్రహాలు",
    "గ్రామీణ ఆర్ధిక వ్యవస్థ",
    "గ్రామీణ జీవితం",
    "గ్రామీణాభివృద్ధి",
    "గ్రీన్‌ల్యాండ్",
    "గ్రేట్ బారియర్ రీఫ్",
    "చంద్రుడు",
    "చట్టం",
    "చదరం",
    "చరిత్ర రచన",
    "చరిత్రకారులు",
    "చర్చి",
    "చలనచిత్ర పరిశ్రమ",
    "చారిత్రక నవలలు",
    "చాళుక్యులు",
    "చికిత్స",
    "చిరంజీవి",
    "చెట్లు",
    "చెదరంగం",
    "చెన్నై",
    "చైనా",
    "చోళ రాజవంశం",
    "జంతువుల జాబితా",
    "జంతువులు",
    "జంతుశాస్త్రం",
    "జనాభా లెక్కలు",
    "జర్మనీ",
    "జల కాలుష్యం",
    "జలపాతాలు",
    "జలియన్ వాలా బాగ్",
    "జవహర్ లాల్ నెహ్రూ",
    "జస్టిస్ పార్టీ",
    "జాతీయ చిహ్నాలు",
    "జానపద నృత్యం",
    "జీఎస్టీ",
    "జీడీపీ",
    "జీర్ణ వ్యవస్థ",
    "జీవ వైవిధ్యం",
    "జీవకణం",
    "జీవనశైలి",
    "జీవశాస్త్రం",
    "జెనెటిక్స్",
    "జైన మతం",
    "జొన్న",
    "టీకాలు",
    "టెన్నిస్",
    "టెలివిజన్",
    "టెలిస్కోప్",
    "టేబుల్ టెన్నిస్",
    "టైఫాయిడ్",
    "టోక్యో",
    "టోరంటో",
    "ట్రాఫిక్",
    "డా. బి.ఆర్. అంబేద్కర్",
    "డీఎన్‌ఏ",
    "డెంగ్యూ",
    "డేటా సైన్స్",
    "డేటాబేస్",
    "తబలా",
    "తమిళనాడు",
    "తల",
    "తిక్కన",
    "తిరుపతి",
    "తీవ్రమైన వ్యాధి",
    "తుఫాను",
    "తూర్పు కనుమలు",
    "తెలంగాణ",
    "తెలుగు అకాడమీ",
    "తెలుగు నటులు",
    "తెలుగు భాష",
    "తెలుగు సాహిత్యం",
    "తెలుగు సినిమాలు",
    "త్రిభుజం",
    "దక్కన్ పీఠభూమి",
    "దసరా",
    "దాండి మార్చి",
    "దాశరథి రంగాచార్య",
    "దీపావళి",
    "దుఃఖం",
    "దుబాయ్",
    "దేవాలయాలు",
    "దేవులపల్లి కృష్ణశాస్త్రి",
    "ద్రవ్య విధానం",
    "ద్రవ్యం",
    "ద్రవ్యలోటు",
    "ద్రవ్యోల్బణం",
    "ద్వేషం",
    "నగర ప్రణాళిక",
    "నదులు",
    "నన్నయ్య",
    "నర్మదా నది",
    "నవలా సాహిత్యం",
    "నవ్వు",
    "నాగలి",
    "నాటకం",
    "నాడీ వ్యవస్థ",
    "నాడులు",
    "నానోటెక్నాలజీ",
    "నిచ్చెన",
    "నిరక్షరాస్యత",
    "నీటిపారుదల",
    "నీటిపారుదల ప్రాజెక్టులు",
    "నీరు",
    "నెట్‌వర్కింగ్",
    "నైలు నది",
    "న్యాయ సమీక్ష",
    "న్యాయం",
    "న్యూటన్",
    "పంచాయితీ",
    "పండుగలు",
    "పండ్లు",
    "పక్షులు",
    "పత్తి",
    "పత్రికా రంగం",
    "పద్యం",
    "పనిముట్లు",
    "పన్నుల వ్యవస్థ",
    "పరమాణువు",
    "పరికరం",
    "పర్యావరణ పరిరక్షణ",
    "పర్యావరణ పరిశుభ్రత",
    "పర్యావరణం",
    "పర్వతాలు",
    "పవన్ కళ్యాణ్",
    "పశ్చిమ కనుమలు",
    "పశ్చిమ బెంగాల్",
    "పాఠశాల",
    "పార",
    "పారిశ్రామిక విధానం",
    "పారిశ్రామికీకరణ",
    "పారిస్",
    "పార్లమెంట్",
    "పీ.వి. సింధు",
    "పురాతన భారతదేశం",
    "పురావస్తు శాస్త్రం",
    "పురుగుల మందులు",
    "పువ్వులు",
    "పుష్కరాలు",
    "పూలు",
    "పెళ్లి",
    "పేదరికం",
    "పైథాన్",
    "పొంగల్",
    "పోషకాహారం",
    "పౌర సమాజం",
    "పౌర హక్కులు",
    "పౌరసత్వ చట్టం",
    "పౌరసత్వం",
    "ప్రజాస్వామ్యం",
    "ప్రధాన మంత్రి",
    "ప్రధాని పాత్ర",
    "ప్రపంచ పర్వతాలు",
    "ప్రపంచ బ్యాంకు",
    "ప్రపంచ భౌగోళికం",
    "ప్రపంచీకరణ",
    "ప్రభాస్",
    "ప్రభుత్వం",
    "ప్రాథమిక చికిత్స",
    "ప్రాథమిక విధులు",
    "ప్రేమ",
    "ఫార్ములా 1",
    "ఫుట్‌బాల్",
    "ఫైథాగరస్ సిద్ధాంతం",
    "ఫ్రాన్స్",
    "బంగాళాఖాతం",
    "బడ్జెట్",
    "బమ్మెర పోతన",
    "బయోమెట్రిక్స్",
    "బర్లిన్",
    "బస్సు",
    "బాడ్మింటన్",
    "బాస్కెట్‌బాల్",
    "బిగ్ డేటా",
    "బిర్యాని",
    "బీజగణితం",
    "బీమా",
    "బెంగళూరు",
    "బైబిల్",
    "బౌద్ధ మతం",
    "బ్యాంకింగ్",
    "బ్రహ్మ",
    "బ్రెజిల్",
    "బ్లాక్ హోల్స్",
    "బ్లాక్‌చెయిన్",
    "భగవద్గీత",
    "భయం",
    "భరతనాట్యం",
    "భారత ఎన్నికల సంఘం",
    "భారత జాతీయ కాంగ్రెస్",
    "భారత పార్లమెంటు",
    "భారత స్వాతంత్ర్య ఉద్యమం",
    "భారతదేశ ఆర్థిక వ్యవస్థ",
    "భారతదేశ చరిత్ర",
    "భారతదేశ రాజధాని",
    "భారతదేశ వాతావరణం",
    "భారతదేశం",
    "భారతీయ కళలు",
    "భారతీయ నృత్యం",
    "భారతీయ పండుగలు",
    "భారతీయ రిజర్వ్ బ్యాంక్",
    "భారతీయ రైల్వే",
    "భారతీయ వంటకాలు",
    "భారతీయ శిక్షాస్మృతి",
    "భావాలు",
    "భావోద్వేగం",
    "భూకంపాలు",
    "భూగర్భ జలం",
    "భూమధ్య రేఖ",
    "భూమి",
    "భౌతిక శాస్త్రం",
    "మందులు",
    "మతం",
    "మధ్యధరా సముద్రం",
    "మర పనిముట్టు",
    "మరాఠా సామ్రాజ్యం",
    "మలేరియా",
    "మసీదు",
    "మహా ప్రస్థానం",
    "మహాత్మా గాంధీ",
    "మహానది",
    "మహాభారతం",
    "మహారాష్ట్ర",
    "మహేష్ బాబు",
    "మానవ శరీరము",
    "మానసిక ఆరోగ్యం",
    "ముంబై",
    "మునిసిపాలిటీ",
    "మూత్రపిండాలు",
    "మెక్సికో నగరం",
    "మెదడు",
    "మొక్కలు",
    "మొఘల్ సామ్రాజ్యం",
    "మోటారుసైకిల్",
    "మౌంట్ ఎవరెస్ట్",
    "మ్యూచువల్ ఫండ్స్",
    "యంత్ర అభ్యాసం",
    "యమునా నది",
    "యాప్స్",
    "యోగా",
    "రక్త ప్రసరణ వ్యవస్థ",
    "రక్తం",
    "రక్తపోటు",
    "రష్యా",
    "రసాయన బంధం",
    "రసాయన శాస్త్రం",
    "రాకెట్",
    "రాజకీయ పార్టీలు",
    "రాజకీయ వ్యవస్థ",
    "రాజనీతి శాస్త్రం",
    "రాజమౌళి",
    "రాజస్థాన్",
    "రాజ్యాంగం",
    "రామాయణ కల్పవృక్షం",
    "రామాయణం",
    "రాష్ట్రపతి",
    "రాష్ట్రపతి అధికారాలు",
    "రుణాల",
    "రుద్రమదేవి",
    "రేఖాగణితం",
    "రేడియో",
    "రైతు",
    "రైలు",
    "రోగ నిర్ధారణ",
    "రోగనిరోధక వ్యవస్థ",
    "రోబోటిక్స్",
    "రోమ్",
    "లండన్",
    "లక్ష్మి",
    "లింగ వివక్ష",
    "వచన కవిత్వం",
    "వన్యప్రాణి సంరక్షణ",
    "వయోలిన్",
    "వరి",
    "వర్షపాతం",
    "వల",
    "వస్త్రధారణ",
    "వాతావరణ మార్పు",
    "వాతావరణ శాస్త్రం",
    "వాతావరణం",
    "వాయువు",
    "వాలీబాల్",
    "వాల్మీకి",
    "వాస్తుశిల్పం",
    "వింధ్య పర్వతాలు",
    "విజయనగర సామ్రాజ్యం",
    "విటమిన్లు",
    "విత్తనాలు",
    "విదేశాంగ విధానం",
    "విద్య",
    "విద్యుత్ ఉత్పత్తి",
    "విద్యుదయస్కాంతత్వం",
    "వినాయకుడు",
    "వినియోగదారుల హక్కులు",
    "విపణి",
    "విమానం",
    "విరాట్ కోహ్లి",
    "విశాఖపట్నం",
    "విశ్వ క్రీడలు",
    "విశ్వనాథ సత్యనారాయణ",
    "విశ్వవిద్యాలయం",
    "విష్ణువు",
    "వృక్షశాస్త్రం",
    "వృక్షాలు",
    "వృత్తం",
    "వేణువు",
    "వేదాలు",
    "వేమన",
    "వేషధారణ",
    "వైద్య విద్య",
    "వైద్యం",
    "వైద్యశాల",
    "వైద్యుడు",
    "వ్యవసాయ రుణాల",
    "వ్యవసాయం",
    "వ్యాకరణం",
    "వ్యాక్సిన్",
    "వ్యాధులు",
    "వ్యాపారం",
    "వ్యాపారవేత్త",
    "శబరిమల",
    "శరీర ధర్మ శాస్త్రము",
    "శాకుంతలం",
    "శాతవాహనులు",
    "శాసనసభ",
    "శాస్త్రీయ సంగీతం",
    "శిల్పం",
    "శివుడు",
    "శుభ్రత",
    "శ్రీనాథుడు",
    "శ్రీశ్రీ",
    "సంక్రాంతి",
    "సంఖ్యలు",
    "సంగీత పరికరాలు",
    "సంగీత శాస్త్రం",
    "సంస్కృత భాష",
    "సంస్కృతి",
    "సచిన్ టెండూల్కర్",
    "సమతుల్య ఆహారం",
    "సముద్ర మట్టం పెరుగుదల",
    "సముద్రాలు",
    "సమ్మెట",
    "సరస్వతి",
    "సరీసృపాలు",
    "సహారా ఎడారి",
    "సాంకేతిక విద్య",
    "సాంకేతికత",
    "సాంప్రదాయ వస్త్రధారణ",
    "సాంప్రదాయాలు",
    "సాధనం",
    "సాధారణ శకం",
    "సాఫ్ట్‌వేర్",
    "సాఫ్ట్‌వేర్ ఇంజనీరింగ్",
    "సామాజిక న్యాయం",
    "సామాజిక భద్రత",
    "సామాజిక సంస్కరణలు",
    "సాహిత్యం",
    "సి. నారాయణరెడ్డి",
    "సింగపూర్",
    "సిక్కు మతం",
    "సినీ దర్శకులు",
    "సునామీ",
    "సుప్రీం కోర్టు",
    "సుభాష్ చంద్ర బోస్",
    "సుస్థిర అభివృద్ధి",
    "సూక్ష్మజీవశాస్త్రం",
    "సూఫీజం",
    "సూర్యుడు",
    "సైకిల్",
    "సైనా నెహ్వాల్",
    "సైబర్ సెక్యూరిటీ",
    "సోషల్ మీడియా",
    "సౌరశక్తి",
    "స్టాక్ మార్కెట్",
    "స్టార్టప్",
    "స్టీఫెన్ హాకింగ్",
    "స్త్రీల హక్కులు",
    "స్థానిక సంస్థలు",
    "స్విమ్మింగ్",
    "హక్కులు",
    "హర్షవర్ధనుడు",
    "హాకీ",
    "హార్డ్‌వేర్","హిందూ పురాణాలు","హిందూ మహాసముద్రం","హిమాలయాలు","హైకోర్టు","హైదరాబాద్",
]
    merged_filename = "merged_telugu_wikipedia_data.txt"

    pages_per_search = 25

    total_terms = len(search_terms)
    for j, term in enumerate(search_terms):
        overall_percentage = (j + 1) / total_terms * 100
        print(f"\n--- Starting new search for term {j+1} of {total_terms} ({overall_percentage:.1f}% overall) : {term} ---")
        scrape_and_merge_telugu_text_from_search(term, merged_filename, limit=pages_per_search)
    
    print("\n--- All scraping and merging completed. ---")
